<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>ADL Index</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>
    <script src="../makeCalculator.js"></script>
  </head>
  <body>
    <div
      class="min-h-full flex items-center justify-center py-12 px-10 sm:px-6 lg:px-8"
    >
      <div class="sm:max-w-md w-full space-y-8">
        <div>
          <h1 class="mt-6 text-center text-3xl font-bold text-blue-700">
            ADL Index
          </h1>
        </div>
        <form
          id="calculator"
          class="rounded-md"
          oninput="
          adl_result = 
            parseInt(feeding.value) +
            parseInt(bathing.value) +
            parseInt(grooming.value) +
            parseInt(dressing.value) +
            parseInt(bowel_control.value) +
            parseInt(bladder_control.value) +
            parseInt(toilet_use.value) +
            parseInt(transfers.value) +
            parseInt(mobility.value) +
            parseInt(stairs.value);
          if(isNaN(adl_result)){adl.value = '... points'}
          else if (adl_result == 1){adl.value = adl_result + ' point'}
          else{adl.value = adl_result + ' points'}
        "
        >
          <!-- Feeding -->
          <div class="flex items-center mt-2">
            <label
              class="block text-base sm:text-sm font-medium text-gray-700 mr-2"
            >
              Feeding:
            </label>
            <select
              class="block shadow-sm sm:text-base border-gray-300 rounded-md"
              name="feeding"
              value="0"
            >
              <option selected="selected" value="10">Independent</option>
              <option value="5">Needs help</option>
              <option value="0">Unable</option>
            </select>
          </div>
          <!-- Bathing -->
          <div class="flex items-center mt-2">
            <label
              class="block text-base sm:text-sm font-medium text-gray-700 mr-2"
            >
              Bathing:
            </label>
            <select
              class="block shadow-sm sm:text-base border-gray-300 rounded-md"
              name="bathing"
              value="0"
            >
              <option selected="selected" value="5">Independent</option>
              <option value="0">Unable</option>
            </select>
          </div>
          <!-- Grooming -->
          <div class="flex items-center mt-2">
            <label
              class="block text-base sm:text-sm font-medium text-gray-700 mr-2"
            >
              Grooming:
            </label>
            <select
              class="block shadow-sm sm:text-base border-gray-300 rounded-md"
              name="grooming"
              value="0"
            >
              <option selected="selected" value="5">Independent</option>
              <option value="0">Unable</option>
            </select>
          </div>
          <!-- Dressing -->
          <div class="flex items-center mt-2">
            <label
              class="block text-base sm:text-sm font-medium text-gray-700 mr-2"
            >
              Dressing:
            </label>
            <select
              class="block shadow-sm sm:text-base border-gray-300 rounded-md"
              name="dressing"
              value="0"
            >
              <option selected="selected" value="10">Independent</option>
              <option value="5">Needs help</option>
              <option value="0">Unable</option>
            </select>
          </div>
          <!-- Bowel Control -->
          <div class="flex items-center mt-2">
            <label
              class="block text-base sm:text-sm font-medium text-gray-700 mr-2"
            >
              Bowel Control:
            </label>
            <select
              class="block shadow-sm sm:text-base border-gray-300 rounded-md"
              name="bowel_control"
              value="0"
            >
              <option selected="selected" value="10">Continent</option>
              <option value="5">Occasional accident</option>
              <option value="0">Incontinent</option>
            </select>
          </div>
          <!-- Bladder Control -->
          <div class="flex items-center mt-2">
            <label
              class="block text-base sm:text-sm font-medium text-gray-700 mr-2"
            >
              Bladder Control:
            </label>
            <select
              class="block shadow-sm sm:text-base border-gray-300 rounded-md"
              name="bladder_control"
              value="0"
            >
              <option selected="selected" value="10">Continent</option>
              <option value="5">Occasional accident</option>
              <option value="0">Incontinent</option>
            </select>
          </div>
          <!-- Toilet Use -->
          <div class="flex items-center mt-2">
            <label
              class="block text-base sm:text-sm font-medium text-gray-700 mr-2"
            >
              Toilet Use:
            </label>
            <select
              class="block shadow-sm sm:text-base border-gray-300 rounded-md"
              name="toilet_use"
              value="0"
            >
              <option selected="selected" value="10">Independent</option>
              <option value="5">Needs help</option>
              <option value="0">Unable</option>
            </select>
          </div>
          <!-- Transfers -->
          <div class="flex items-center mt-2">
            <label
              class="block text-base sm:text-sm font-medium text-gray-700 mr-2"
            >
              Transfers (bed to chair and back):
            </label>
            <select
              class="block shadow-sm sm:text-base border-gray-300 rounded-md"
              name="transfers"
              value="0"
            >
              <option selected="selected" value="15">Independent</option>
              <option value="10">Needs minor help</option>
              <option value="5">Needs major help</option>
              <option value="0">Unable</option>
            </select>
          </div>
          <!-- Mobility -->
          <div class="flex items-center mt-2">
            <label
              class="block text-base sm:text-sm font-medium text-gray-700 mr-2"
            >
              Mobility on level surfaces:
            </label>
            <select
              class="block shadow-sm sm:text-base border-gray-300 rounded-md"
              name="mobility"
              value="0"
            >
              <option selected="selected" value="15">Independent</option>
              <option value="10">Walks with help</option>
              <option value="5">Wheelchair independent</option>
              <option value="0">Immobile</option>
            </select>
          </div>
          <!-- Stairs -->
          <div class="flex items-center mt-2">
            <label
              class="block text-base sm:text-sm font-medium text-gray-700 mr-2"
            >
              Stairs:
            </label>
            <select
              class="block shadow-sm sm:text-base border-gray-300 rounded-md"
              name="stairs"
              value="0"
            >
              <option selected="selected" value="10">Independent</option>
              <option value="5">Needs help</option>
              <option value="0">Unable</option>
            </select>
          </div>
          <!-- Total Points -->
          <div class="flex items-center mt-6">
            <label class="block font-bold text-gray-700 mr-2"
              >Total Points:</label
            >
            <output
              name="adl"
              class="block w-fit text-2xl text-center items-center justify-center px-5 py-3 border border-transparent font-medium rounded-md text-blue-700 bg-indigo-50 hover:bg-indigo-300"
            ></output>
          </div>
        </form>
      </div>
    </div>

    <script>
      $(document).ready(function () {
        console.debug('1. Connecting calculator...');
        makeCalculatorV3(
          'calculator',
          function (data) {
            /**
             * The object below is the Observation instance that will be sent back to Cicero
             **/
            const observation = {
              text: {
                status: 'generated',
                div: `<span xmlns='http://www.w3.org/1999/xhtml'>${data.adl}</span>`,
              },
              resourceType: 'Observation',
              code: {
                text: 'ADL index',
                coding: [
                  {
                    display: 'ADL index',
                    code: '6c866e46-1912-11ef-9262-0242ac120002',
                    system: 'http://tiro.health/fhir/CodeSystem/auto-generated',
                  },
                ],
              },
              valueQuantity: {
                value: adl_result,
                unit: 'points',
                code: '281850001',
                system: 'http://snomed.info/sct',
              },
            };
            console.debug(observation);
            return observation;
          },
          { autoSave: true },
        );
        console.debug('2. Calculator setup done.');
      });
    </script>
  </body>
</html>
