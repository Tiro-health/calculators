<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>
    <script src="../makeCalculator.js"></script>
    <title>Geriatric Screening</title>
    <meta charset="UTF-8" />
  </head>
  <body>
    <div
      class="min-h-full flex items-center justify-center py-12 px-10 sm:px-6 lg:px-8"
    >
      <div class="sm:max-w-md w-full space-y-8">
        <div>
          <h1 class="mt-6 text-center text-3xl font-bold text-blue-700">
            Geriatric Screening
          </h1>
        </div>

        <form
          id="calculator"
          class="rounded-md"
          oninput="
        risk_score= parseInt(food_intake.value)+
                    parseInt(weight.value)+
                    parseInt(mobility.value)+
                    parseInt(neuro.value)+
                    parseInt(bmi.value)+
                    parseInt(status.value)+
                    parseInt(age.value)
        console.log(risk_score)

        if(isNaN(risk_score)){total_risk_score.value = '... points'}
          else if (risk_score==1){total_risk_score.value = risk_score + ' point'}
          else{total_risk_score.value = risk_score + ' points'}
        if (isNaN(risk_score)){recommendation.value = 'Please fill in all questions'}
          else if (risk_score<=14){recommendation.value = 'Full geriatric evaluation'}
          else if (risk_score>14){recommendation.value = 'Full geriatric evaluation not necessary'}
          else{recommendation.value = ''}         
        "
        >
          <div class="col-span-6 sm:col-span-3 lg:col-span-2">
            <label class="block text-base sm:text-sm font-medium text-gray-700">
              Identifies elderly cancer patients who could benefit from
              comprehensive geriatric assessment (CGA) (

              <a
                href="https://www.mdcalc.com/calc/10426/g8-geriatric-screening-tool#evidence"
                >source</a
              >)
            </label>
          </div>
          <p>&nbsp;</p>

          <div class="col-span-6 sm:col-span-3 lg:col-span-2">
            <label class="block text-base sm:text-sm font-medium text-gray-700">
              Has food intake declined over the past 3 months due to loss of
              appetite, digestive problems, chewing, or swallowing difficulties?
            </label>
            <select
              class="t-1 block shadow-sm sm:text-base sm:text-sm border-gray-300 rounded-md"
              as="select"
              name="food_intake"
              value="0"
            >
              <option selected="selected" value="2"
                >No decrease in food intake (+2)</option
              >
              <option value="1">Moderate decrease in food intake (+1)</option>
              <option value="0">Severe decrease in food intake (+0)</option>
            </select>
          </div>
          <p>&nbsp;</p>
          <div class="col-span-6 sm:col-span-3 lg:col-span-2">
            <label class="block text-base sm:text-sm font-medium text-gray-700">
              Weight loss during the last 3 months (kg):
            </label>
            <select
              class="t-1 block shadow-sm sm:text-base sm:text-sm border-gray-300 rounded-md"
              as="select"
              name="weight"
              value="0"
            >
              <option selected="selected" value="3">No weight loss (+3)</option>
              <option value="2">1-3 kg (+2) </option>
              <option value="0">>3 kg (+0)</option>
              <option value="1">Does not know (+1) </option>
            </select>
          </div>
          <p>&nbsp;</p>

          <div class="col-span-6 sm:col-span-3 lg:col-span-2">
            <label class="block text-base sm:text-sm font-medium text-gray-700">
              Mobility
            </label>
            <select
              class="t-1 block shadow-sm sm:text-base sm:text-sm border-gray-300 rounded-md"
              as="select"
              name="mobility"
              value="0"
            >
              <option selected="selected" value="3">No weight loss (+3)</option>
              <option value="2">1-3 kg (+2) </option>
              <option value="0">>3 kg (+0)</option>
              <option value="1">Does not know (+1) </option>
            </select>
          </div>
          <p>&nbsp;</p>

          <div class="col-span-6 sm:col-span-3 lg:col-span-2">
            <label class="block text-base sm:text-sm font-medium text-gray-700">
              Neuropsychological conditions:
            </label>
            <select
              class="t-1 block shadow-sm sm:text-base sm:text-sm border-gray-300 rounded-md"
              as="select"
              name="neuro"
              value="0"
            >
              <option selected="selected" value="2"
                >No psychological conditions (+2)</option
              >
              <option value="1">Mild dementia (+1) </option>
              <option value="0">>Severe dementia or depression (+0)</option>
            </select>
          </div>
          <p>&nbsp;</p>

          <div class="col-span-6 sm:col-span-3 lg:col-span-2">
            <label class="block text-base sm:text-sm font-medium text-gray-700">
              Body mass index (BMI) (kg/m2):
            </label>
            <select
              class="t-1 block shadow-sm sm:text-base sm:text-sm border-gray-300 rounded-md"
              as="select"
              name="bmi"
              value="0"
            >
              <option selected="selected"></option>
              <option value="0"><19 kg/m2 (+0) </option>
              <option value="1">>19 to <21 kg/m2 (+1) </option>
              <option value="2">21 to <23 kg/m2 (+2) </option>
              <option value="3">â‰¥23 kg/m2 (+3) </option>
            </select>
          </div>
          <p>&nbsp;</p>

          <div class="mt-2">
            <label class="block text-base sm:text-sm font-medium text-gray-700">
              Takes more than three prescription drugs per day:
            </label>
            <input
              class="rounded text-blue-700"
              type="radio"
              name="drugs"
              value="1"
            /><label class="mx-1">No</label>
            <input
              class="rounded text-blue-700"
              type="radio"
              name="drugs"
              value="1"
              checked="checked"
            /><label class="mx-1">Yes</label>
          </div>
          <p>&nbsp;</p>

          <div class="col-span-6 sm:col-span-3 lg:col-span-2">
            <label class="block text-base sm:text-sm font-medium text-gray-700">
              In comparison with other people of the same age, how does the
              patient consider their health status?
            </label>
            <select
              class="t-1 block shadow-sm sm:text-base sm:text-sm border-gray-300 rounded-md"
              as="select"
              name="status"
              value="0"
            >
              <option selected="selected"></option>
              <option value="0">Not as good (+0) </option>
              <option value="0.5">Doest not know (+0.5)</option>
              <option value="1">As good (+1) </option>
              <option value="2">Better (+2) </option>
            </select>
          </div>
          <p>&nbsp;</p>

          <div class="col-span-6 sm:col-span-3 lg:col-span-2">
            <label class="block text-base sm:text-sm font-medium text-gray-700">
              Age (years):
            </label>
            <select
              class="t-1 block shadow-sm sm:text-base sm:text-sm border-gray-300 rounded-md"
              as="select"
              name="age"
              value="0"
            >
              <option selected="selected"></option>
              <option value="0">>85 (+0) </option>
              <option value="1">80-85 (+1) </option>
              <option value="2"><80 (+2) </option>
            </select>
          </div>
          <div class="col-span-6 sm:col-span-3 lg:col-span-2"></div>

          <p>&nbsp;</p>

          <div class="col-span-6 sm:col-span-3 lg:col-span-2 block">
            <label class="block font-bold text-gray-700"
              >TOTAL RISK SCORE</label
            >

            <p>&nbsp;</p>
            <output
              name="total_risk_score"
              class="block w-fit text-2xl text-center items-center justify-center px-5 py-3 border border-transparent font-medium rounded-md text-blue-700 bg-indigo-50 hover:bg-indigo-300"
            />
          </div>

          <p>&nbsp;</p>
          <div class="col-span-6 sm:col-span-3 lg:col-span-2 block">
            <label class="block font-bold text-gray-700"></label>
            <output
              name="recommendation"
              class="block w-fit text-2xl text-center items-center justify-center px-5 py-3 border border-transparent font-medium rounded-md text-blue-700 bg-indigo-50 hover:bg-indigo-300"
            />
          </div>

        </form>
      </div>
    </div>
    <script>
      $(document).ready(function () {
        console.debug('1. Connecting calculator...');
        makeCalculatorV3(
          'calculator',
          function (data) {
            /**
             * The object bellow is the Observation instance that will be sent back to Cicero
             **/

            const observation = {
              text: {
                status: "generated",
                div: `<span xmlns='http://www.w3.org/1999/xhtml'>${data.total_risk_score}</span>`,
              },
              resourceType: 'Observation',
              code: {
                text: 'Geriatische screening',
                coding: [
                  {
                    display: 'Geriatische screening',
                    code: 'urn:uuid:0431f778-0d05-4f78-92c3-84835b7de950',
                    system: 'http://tiro.health/fhir/CodeSystem/auto-generated',
                  },
                ],
              },
              valueQuantity: {
                value: risk_score,
                unit: 'points',
                code: '281850001',
                system: 'http://snomed.info/sct',
              },
            };
            console.debug(observation);
            return observation;
          },
          { autoSave: true },
        );
        console.debug('2. Calculator setup done.');
      });
    </script>
  </body>
</html>
