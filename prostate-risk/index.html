<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>
    <title>Prostate Risk Calculator</title>
  </head>
  <body>
    <div
      class="min-h-full flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8"
    >
      <div class="max-w-md w-full space-y-8">
        <div class="flex items-center justify-center">
          <img src="TIRO_logo.png" alt="TIRO Logo" class="mr-2" /> <!-- Add image here -->
          <h1 class="mt-6 text-center text-3xl font-bold text-blue-700">
            Prostate Risk Calculator
          </h1>
        </div>
        <div class="col-span-6 sm:col-span-3 lg:col-span-2">
          <label class="block text-sm font-medium text-gray-700">
            Disclaimer: This calculator is developed for and in collaboration with Dr. Van Baelen (AZ Marie Middelares). It is currently available for demonstration purposes only.
          </label>
        </div>
        <form
          id="calculator"
          class="rounded-md"
          oninput="
            psadt=psa.value/vol.value;
            XAGE = age.value / 100;
            XPSADT = psadt / 0.1;
            XVOL = Math.pow(vol.value / 100, -1);
            XPSA = Math.pow(psa.value / 10, -2);
            multiples = 0;
            
            multiples = (pirads.value == 2 ? (1.4087 / 2) : 0) + (pirads.value == 3 ? (1.8314 / 3) : 0);
          
            // Replace pirads with specific scores
            if (pirads.value == 1) {
              pirads_score = 0;
            } else if (pirads.value == 2) {
              pirads_score = 0;
            } else if (pirads.value == 3) {
              pirads_score = 1;
            } else if (pirads.value == 4) {
              pirads_score = 2;
            } else if (pirads.value == 5) {
              pirads_score = 3;
            }

            lin_pred = -10.288 - (0.0811 * XPSA) + (10.9143 * XAGE) + (1.1954 * XVOL) + pirads_score * multiples - (0.9820 * zone.value) + (0.329 * XPSADT);

            logit_p = lin_pred.toFixed(2);

            if (isNaN(logit_p)) {
              result.value = 'Invalid Input';
            } else {
              result.value = logit_p;
            }
          "
        >
          <!-- Rest of your form elements remain unchanged -->

          <div class="col-span-6 sm:col-span-3 lg:col-span-2 block">
            <label for="result" class="block font-bold text-gray-700">
              Result:
            </label>
            <output
              class="text-2xl inline-flex text-center items-center justify-center px-5 py-3 border border-transparent font-medium rounded-md text-blue-700 bg-blue-50 hover:bg-blue-300"
              name="result"
              form="calculator"
            >
              0.00
            </output>
          </div>
        </form>
      </div>
    </div>
    <script>
      $(document).ready(function () {
        console.debug('1. Connecting calculator...');
        makeCalculatorV3(
          'calculator',
          function (data) {
            const observation = {
              resourceType: 'Observation',
              code: {
                text: 'Prostate Risk Logit',
                coding: [
                  {
                    display: 'Prostate Risk Logit',
                    code: 'urn:uuid:your-code-here',
                    system: 'http://tiro.health/fhir/CodeSystem/auto-generated',
                  },
                ],
              },
              valueQuantity: {
                value: parseFloat(logit_p),
                unit: 'points',
                code: '281850001',
                system: 'http://snomed.info/sct',
              },
            };
            console.debug(observation);
            return observation;
          },
          { autoSave: true },
        );
        console.debug('2. Calculator setup done.');
      });
    </script>
  </body>
</html>
