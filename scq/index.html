<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>
    <script src="../makeCalculator.js"></script>
    <title>Self-Administered Comorbidity Questionnaire</title>
    <meta charset="UTF-8" />
  </head>
  <body>
    <script type="text/javascript"></script>
    <div
      class="min-h-full flex items-center justify-center py-12 px-10 sm:px-6 lg:px-8"
    >
      <div class="sm:max-w-md w-full space-y-8">
        <div>
          <h1 class="mt-6 text-center text-3xl font-bold text-blue-700">
            Charlson Comorbidity Index
          </h1>
        </div>
        <form
          id="calculator"
          class="rounded-md"
        >
          <div class="mt-2">
            <label class="block text-base sm:text-sm font-medium text-gray-700">
              I have no other diseases:
            </label>
            <input
              class="rounded text-blue-700"
              type="radio"
              name="diseases"
              value="0"
              checked="checked"
            /><label class="mx-1">No</label>
            <input
              class="rounded text-blue-700"
              type="radio"
              name="diseases"
              value="1"
            /><label class="mx-1">Yes</label>
          </div>

          <div class="mt-2">
            <label class="block text-base sm:text-sm font-medium text-gray-700">
              Heart disease (angina, heart attack or heart failure):
            </label>
            <input
              class="rounded text-blue-700"
              type="radio"
              name="heart"
              value="0"
              checked="checked"
            /><label class="mx-1">No</label>
            <input
              class="rounded text-blue-700"
              type="radio"
              name="heart"
              value="1"
            /><label class="mx-1">Yes</label>
          </div>

          <div class="mt-2">
            <label class="block text-base sm:text-sm font-medium text-gray-700">
              High blood pressure:
            </label>
            <input
              class="rounded text-blue-700"
              type="radio"
              name="bloodpressure"
              value="0"
              checked="checked"
            /><label class="mx-1">No</label>
            <input
              class="rounded text-blue-700"
              type="radio"
              name="bloodpressure"
              value="1"
            /><label class="mx-1">Yes</label>
          </div>

          <div class="mt-2">
            <label class="block text-base sm:text-sm font-medium text-gray-700">
              Leg pain when walking due to poor circulation:
            </label>
            <input
              class="rounded text-blue-700"
              type="radio"
              name="legpain"
              value="0"
              checked="checked"
            /><label class="mx-1">No</label>
            <input
              class="rounded text-blue-700"
              type="radio"
              name="legpain"
              value="1"
            /><label class="mx-1">Yes</label>
          </div>
          <div class="mt-2">
            <label class="block text-base sm:text-sm font-medium text-gray-700">
              Diabetes:
            </label>
            <input
              class="rounded text-blue-700"
              type="radio"
              name="diabetes"
              value="0"
              checked="checked"
            /><label class="mx-1">No</label>
            <input
              class="rounded text-blue-700"
              type="radio"
              name="diabetes"
              value="1"
            /><label class="mx-1">Yes</label>
          </div>
          <div class="mt-2">
            <label class="block text-base sm:text-sm font-medium text-gray-700">
              Kidney disease:
            </label>
            <input
              class="rounded text-blue-700"
              type="radio"
              name="kidney"
              value="0"
              checked="checked"
            /><label class="mx-1">No</label>
            <input
              class="rounded text-blue-700"
              type="radio"
              name="kidney"
              value="1"
            /><label class="mx-1">Yes</label>
          </div>
          <div class="mt-2">
            <label class="block text-base sm:text-sm font-medium text-gray-700">
              Liver disease:
            </label>
            <input
              class="rounded text-blue-700"
              type="radio"
              name="liver"
              value="0"
              checked="checked"
            /><label class="mx-1">No</label>
            <input
              class="rounded text-blue-700"
              type="radio"
              name="liver"
              value="1"
            /><label class="mx-1">Yes</label>
          </div>
          <div class="mt-2">
            <label class="block text-base sm:text-sm font-medium text-gray-700">
              Problem caused by stroke:
            </label>
            <input
              class="rounded text-blue-700"
              type="radio"
              name="stroke"
              value="0"
              checked="checked"
            /><label class="mx-1">No</label>
            <input
              class="rounded text-blue-700"
              type="radio"
              name="stroke"
              value="1"
            /><label class="mx-1">Yes</label>
          </div>
          <div class="mt-2">
            <label class="block text-base sm:text-sm font-medium text-gray-700">
              Disease of the nervous system (Parkinson's or multiple sclerosis):
            </label>
            <input
              class="rounded text-blue-700"
              type="radio"
              name="nervous"
              value="0"
              checked="checked"
            /><label class="mx-1">No</label>
            <input
              class="rounded text-blue-700"
              type="radio"
              name="nervous"
              value="1"
            /><label class="mx-1">Yes</label>
          </div>
          <div class="mt-2">
            <label class="block text-base sm:text-sm font-medium text-gray-700">
              Other cancer (within the last 5 years):
            </label>
            <input
              class="rounded text-blue-700"
              type="radio"
              name="cancer"
              value="0"
              checked="checked"
            /><label class="mx-1">No</label>
            <input
              class="rounded text-blue-700"
              type="radio"
              name="cancer"
              value="1"
            /><label class="mx-1">Yes</label>
          <p>&nbsp;</p>
        </form>
      </div>
    </div>
    <script>
      $(document).ready(function () {
        const NAME_SHORT_DESCRIPTION_MAP = {
          diseases: "No other diseases",
          heart: "Heart disease",
          bloodpressure: "High blood pressure",
          legpain: "Leg pain when walking due to poor circulation",
          diabetes: "Diabetes",
          kidney: "Kidney disease",
          liver: "Liver disease",
          stroke: "Problem caused by stroke",
          nervous: "Disease of the nervous system",
          cancer: "Other cancer",
        };
        function dataToNarrative(data) {
          const narrative = [];
          for (const [key, value] of Object.entries(data)) {
            if (value === "0") {
              continue;
            }
            if (!NAME_SHORT_DESCRIPTION_MAP[key]) {
              console.warn(`No description for ${key}`);
              continue;
            }
            narrative.push(NAME_SHORT_DESCRIPTION_MAP[key]);
          }
          return `${narrative.join(", ")}`;
        }
        console.debug("1. Connecting calculator...");
        makeCalculatorV3(
          "calculator",
          function (data) {
            /**
             * The object bellow is the Observation instance that will be sent back to Cicero
             **/
            const observation = {
              text: {
                status: "generated",
                div: dataToNarrative(data),
              },
              resourceType: "Observation",
              code: {
                text: "Self-Administered Comorbidity Questionnaire",
                coding: [
                  {
                    display: "Self-Administered Comorbidity Questionnaire",
                    code: "4a7763975f9f4e52b3ece82e395ec374",
                    system: "http://tiro.health/fhir/CodeSystem/auto-generated",
                  },
                ],
              },
              valueQuantity: {
                value: 0,
                unit: dataToNarrative(data),
                code: "dummy",
                system: "http://tiro.health/fhir/CodeSystem/auto-generated",
              },
            }
            return observation;
          },
          { autoSave: true }
        );
        console.debug("2. Calculator setup done.");
      });
    </script>
  </body>
</html>
